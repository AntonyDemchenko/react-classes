(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e,t,n){e.exports=n(36)},24:function(e,t,n){},25:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a,o=n(0),s=n.n(o),r=n(18),c=n.n(r),i=(n(24),n(2)),l=n(3),u=n(4),d=n(5),m=(n(25),new(function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).events={},e}return Object(l.a)(n,[{key:"emit",value:function(e,t){var n=this.events[e];n&&n.forEach(function(e){e.call(null,t)})}},{key:"subscribe",value:function(e,t){var n=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){n.events[e]=n.events[e].filter(function(e){return t!==e})}}}]),n}(s.a.Component))),h=n(1),f=n(6),p=n.n(f),v=n(8),b=(n(27),n(9)),k=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).state={username:"",password:""},e.todosRef=s.a.createRef(),e}return Object(l.a)(n,[{key:"login",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify(t),e.next=3,fetch("http://localhost:3000/login",{method:"POST",headers:{"Content-Type":"application/json"},body:n});case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleSubmit",value:function(e){this.login(this.state).then(function(e){console.log(e),localStorage.setItem("token",JSON.stringify(e)),m.emit("event: check-login",{login:e.status})}),e.preventDefault(),this.setState({username:"",password:""})}},{key:"setUserName",value:function(e){this.setState({username:e.trim()})}},{key:"setPassword",value:function(e){this.setState({password:e.trim()})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"login"},s.a.createElement("h1",{className:"login_title"},"LOG IN"),s.a.createElement("form",{className:"login_form",onSubmit:function(t){return e.handleSubmit(t)}},s.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,onChange:function(t){return e.setUserName(t.target.value)}}),s.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,onChange:function(t){return e.setPassword(t.target.value)}}),s.a.createElement("div",{className:"submit"},s.a.createElement("button",{className:"submit_btn",type:"submit",value:this.state.password},"Submit"))),s.a.createElement("div",{className:"links"},s.a.createElement(b.b,{to:"/registration",className:"sign-up"},"Sign up!")))}}]),n}(s.a.Component),g=(n(28),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).state={username:"",password:""},e.loginRef=s.a.createRef(),e}return Object(l.a)(n,[{key:"registration",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify(t),e.next=3,fetch("http://localhost:3000/registration",{method:"POST",headers:{"Content-Type":"application/json"},body:n});case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleSubmit",value:function(e){var t=this;this.registration(this.state).then(function(e){console.log("reg",e),localStorage.setItem("token",JSON.stringify({accessToken:e.accesstoken,refreshToken:e.refreshToken})),t.detectRegistration(e.status)}),e.preventDefault(),this.setState({username:"",password:""})}},{key:"detectRegistration",value:function(e){200===e&&this.loginRef.current.click()}},{key:"setUserName",value:function(e){this.setState({username:e})}},{key:"setPassword",value:function(e){this.setState({password:e})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"reg"},s.a.createElement("h1",{className:"reg_title"},"Registration"),s.a.createElement("form",{className:"reg_form",onSubmit:function(t){return e.handleSubmit(t)}},s.a.createElement("input",{type:"text",placeholder:"Username",value:this.state.username,onChange:function(t){return e.setUserName(t.target.value)}}),s.a.createElement("input",{type:"password",placeholder:"Password",value:this.state.password,onChange:function(t){return e.setPassword(t.target.value)}}),s.a.createElement("div",{className:"submit"},s.a.createElement("button",{className:"submit_btn",type:"submit",value:this.state.password},"Submit"))),s.a.createElement(b.b,{to:"/",className:"sign-in",ref:this.loginRef},"Sign in!"))}}]),n}(s.a.Component)),y=(n(29),n(30),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state=void 0,a.state={buttons:["all","active","completed"],selectedButton:"all"},a}return Object(l.a)(n,[{key:"setFilter",value:function(e){this.setState({selectedButton:e.target.value}),m.emit("event:change-filter-type",{filterType:e.target.value})}},{key:"render",value:function(){var e=this;return s.a.createElement("ul",{className:"filter-btns"},this.state.buttons.map(function(t){return s.a.createElement("button",{className:t===e.state.selectedButton?"filter-btns selected":"filter-btn",onClick:e.setFilter.bind(e),value:t,key:Date.now()*Math.random()},t)}))}}]),n}(s.a.Component)),O=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),a=t.call(this,e),console.log(e),a}return Object(l.a)(n,[{key:"setCountActiveTodos",value:function(){return this.props.todos.filter(function(e){return!1===e.completed}).length}},{key:"deleteAllCheckedTodos",value:function(){m.emit("event:delete-all-checked")}},{key:"render",value:function(){var e=this;return console.log("ssssssssssssssssssssss"),s.a.createElement("footer",{className:0===this.props.todos.length?"footer":"footer active"},s.a.createElement("span",{className:"todo-count"},s.a.createElement("span",{className:"todo-count__number"},this.setCountActiveTodos()+" "),s.a.createElement("span",{className:"todo-count__name"},"item "),"left"),s.a.createElement(y,null),s.a.createElement("button",{className:"delete-checked",onClick:function(t){return e.deleteAllCheckedTodos()}},"Clear completed"))}}]),n}(s.a.Component),j=(n(31),n(32),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).state={inputValue:""},e}return Object(l.a)(n,[{key:"handleChange",value:function(e){this.setState({inputValue:e.target.value})}},{key:"handleClick",value:function(e){13===e.keyCode&&e.target.value.trim()&&(m.emit("event:add-item-DB",{title:e.target.value}),this.setState({inputValue:""}))}},{key:"render",value:function(){var e=this;return s.a.createElement("header",{className:"input-header"},s.a.createElement("h1",{className:"main-title"},"todos"),s.a.createElement("input",{onKeyDown:function(t){return e.handleClick(t)},type:"text",className:"todo__input",placeholder:"What needs to be done?",value:this.state.inputValue,onChange:function(t){return e.handleChange(t)}}))}}]),n}(s.a.Component)),E=(n(33),n(34),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={item:e.todo},a}return Object(l.a)(n,[{key:"handleClickDelete",value:function(e){m.emit("event:delete-item",{id:e.target.closest("li").getAttribute("item-id")})}},{key:"handleOnChange",value:function(e){m.emit("event:change-checkbox",{id:e.target.closest("li").getAttribute("item-id"),completed:this.state.item.completed})}},{key:"render",value:function(){var e=this;return s.a.createElement("li",{className:"todos__item","item-id":this.state.item.todo_id},s.a.createElement("input",{className:"todos__toggle",type:"checkbox",checked:this.state.item.completed,onChange:function(t){e.handleOnChange(t),t.stopPropagation()}}),s.a.createElement("p",{className:"todos__title"},this.state.item.title),s.a.createElement("button",{className:"todos__delete",onClick:function(t){e.handleClickDelete(t),t.stopPropagation()}},"\xd7"))}}]),n}(s.a.Component)),T=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={todos:[]},a}return Object(l.a)(n,[{key:"checkAllTodos",value:function(){m.emit("event:change-all-checkboxes")}},{key:"filterTodos",value:function(){var e=[],t=this.props.filterType,n=this.props.todos;return"all"===t?e=n:"active"===t?e=n.filter(function(e){return!1===e.completed}):"completed"===t&&(e=n.filter(function(e){return!0===e.completed})),e}},{key:"render",value:function(){var e=this;return s.a.createElement("section",{className:0===this.props.todos.length?"tasks":"tasks active"},s.a.createElement("button",{className:0!==this.props.todos.length&&this.props.todos.every(function(e){return!0===e.completed})?"check-all active ":"check-all",onClick:function(t){return e.checkAllTodos()}},s.a.createElement("p",{className:"check-all__arrow"},"\u276f")),s.a.createElement("div",{className:"todos-tasks"},s.a.createElement("ul",{className:"todos-list"},this.filterTodos().map(function(e){return s.a.createElement(E,{todo:e,key:e.todo_id})}))))}}]),n}(s.a.Component),N=n(12),C=n(13);!function(e){e.all="all",e.active="active",e.completed="completed"}(a||(a={}));var S=new(function(){function e(){Object(i.a)(this,e),this.state=void 0,this.state={todos:[],filterType:"all",username:""}}return Object(l.a)(e,[{key:"addItemToStore",value:function(e){var t=this.state.todos,n=Object(N.a)(Array,Object(C.a)(t));n.push({title:e.title,todo_id:e.todo_id,completed:e.completed}),this.state.todos=n,m.emit("event: update-store",{})}},{key:"deleteItemFromStore",value:function(e){var t=this.state.todos,n=Object(N.a)(Array,Object(C.a)(t));n=n.filter(function(t){return t.todo_id!==e}),this.state.todos=n,m.emit("event: update-store")}},{key:"changeCompletedStatusOfItemStore",value:function(e){var t=this.state.todos,n=Object(N.a)(Array,Object(C.a)(t));n=n.map(function(t){return t.todo_id===e.todo_id?(t.completed=!t.completed,t):t}),this.state.todos=n,m.emit("event: update-store")}},{key:"checkAllTodos",value:function(){var e=this.state.todos,t=Object(N.a)(Array,Object(C.a)(e));t=t.every(function(e){return!0===e.completed})?t.map(function(e){return e.completed=!1,e}):t.map(function(e){return e.completed=!0,e}),this.state.todos=t,m.emit("event: update-store",{})}},{key:"deleteAllCheckedTodos",value:function(){var e=this.state.todos,t=Object(N.a)(Array,Object(C.a)(e));t=t.filter(function(e){return!1===e.completed}),this.state.todos=t,m.emit("event: update-store")}},{key:"setFilterType",value:function(e){var t=e.filterType;this.state.filterType=t,m.emit("event: update-store")}}]),e}());m.subscribe("event:add-item",function(e){return S.addItemToStore(e)}),m.subscribe("event:change-filter-type",function(e){return S.setFilterType(e)});var w=S,_=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state=void 0,a.state={todos:w.state.todos,filterType:w.state.filterType,username:w.state.username},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;m.emit("event:get-data-from-db"),m.subscribe("event: update-store",function(){e.updateDate()})}},{key:"updateDate",value:function(){this.setState({todos:w.state.todos,filterType:w.state.filterType,username:w.state.username})}},{key:"render",value:function(){return console.log(this.state),s.a.createElement(s.a.Fragment,null,s.a.createElement(j,null),s.a.createElement(T,this.state),s.a.createElement(O,this.state))}}]),n}(s.a.Component),A=(n(35),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state=void 0,a.state={username:w.state.username},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;m.subscribe("event: update-store",function(){e.setUsername()})}},{key:"setUsername",value:function(){this.setState({username:w.state.username})}},{key:"logOut",value:function(){localStorage.clear(),m.emit("event: check-login",{login:""})}},{key:"render",value:function(){return s.a.createElement("header",{className:"main-header"},s.a.createElement("div",{className:"header__user"},s.a.createElement("div",{className:"header__icon"}),s.a.createElement("p",{className:"header__user-title"},"user:"),s.a.createElement("p",{className:"header__username"},this.state.username)),s.a.createElement("button",{className:"header__logout",onClick:this.logOut},"Log out"))}}]),n}(s.a.Component)),D=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={login:"start"},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;m.subscribe("event: check-login",function(t){e.checkLogin(t.login)})}},{key:"checkLogin",value:function(e){this.setState({login:e})}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,this.state.login?s.a.createElement(A,null):s.a.createElement(s.a.Fragment,null),s.a.createElement("div",{className:"container"},s.a.createElement(h.c,null,s.a.createElement(h.a,{path:"/",element:this.state.login?s.a.createElement(_,null):s.a.createElement(k,null)}),s.a.createElement(h.a,{path:"/registration",element:s.a.createElement(g,null)}))))}}]),n}(s.a.Component),x=new(function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,[{key:"getAccessToken",value:function(){return JSON.parse(localStorage.getItem("token"))||"fail"}},{key:"getDataFromDB",value:function(){var e=Object(v.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"),e.next=3,fetch("http://localhost:3000/todos",{method:"GET",headers:{"Content-Type":"application/json",Authorization:this.getAccessToken().accesstoken}});case 3:return t=e.sent,e.abrupt("return",t.json());case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addNewItemDB",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify({title:t.title}),e.next=3,fetch("http://localhost:3000/todos",{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.getAccessToken().accesstoken},body:n});case 3:return a=e.sent,e.abrupt("return",a.json());case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteItemFromDB",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/todos/".concat(t),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:this.getAccessToken().accesstoken}});case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"changeCompletedStatusOfItemDB",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/todos/".concat(t.id),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:this.getAccessToken().accesstoken},body:JSON.stringify({completed:!t.completed})});case 2:return n=e.sent,e.abrupt("return",n.json());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"checkAllTodosDB",value:function(){var e=Object(v.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=!0,w.state.todos.every(function(e){return!0===e.completed})&&(t=!1),e.next=4,fetch("http://localhost:3000/todos/check-all/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:this.getAccessToken().accesstoken}});case 4:e.sent;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"deleteAllCheckedTodosDB",value:function(){var e=Object(v.a)(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/todos/delete-checked/all",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:this.getAccessToken().accesstoken}});case 2:e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}());m.subscribe("event:get-data-from-db",function(e){return x.getDataFromDB().then(function(e){console.log(e),w.state.todos=e.todos,w.state.username=e.user,e.tokens&&(w.state.username=e.tokens.user,localStorage.setItem("token",JSON.stringify(e.tokens))),m.emit("event: update-store",{})}).catch(function(e){m.emit("event: check-login",{login:!1}),console.error("Error:",e)})}),m.subscribe("event:add-item-DB",function(e){return x.addNewItemDB(e).then(function(e){m.emit("event:add-item",{title:e.title,todo_id:e.todo_id,completed:e.completed})})}),m.subscribe("event:delete-item",function(e){return x.deleteItemFromDB(e.id).then(function(e){w.deleteItemFromStore(e.todo_id)})}),m.subscribe("event:change-checkbox",function(e){return x.changeCompletedStatusOfItemDB(e).then(function(e){w.changeCompletedStatusOfItemStore(e)})}),m.subscribe("event:change-all-checkboxes",function(e){return x.checkAllTodosDB().then(function(e){w.checkAllTodos()})}),m.subscribe("event:delete-all-checked",function(e){return x.deleteAllCheckedTodosDB().then(function(e){w.deleteAllCheckedTodos()})});c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(b.a,null,s.a.createElement(D,null))),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.4e99d28c.chunk.js.map